# nixpacks.toml

[phases.setup]
# KOREKSI: Pastikan nama paket Nix yang benar, dan tambahkan ekstensi PHP Laravel.
nix_packages = [
    # PHP Core dan Composer
    "php84",
    "php84Packages.composer",
    # Ekstensi Kritis MySQL/PDO: Penting untuk koneksi database
    "php84Packages.pdo",
    "php84Packages.pdo-mysql", 
    # Ekstensi Laravel lainnya
    "php84Packages.mbstring", 
    "php84Packages.xml",
    "php84Packages.ctype",
    "php84Packages.session",
    "php84Packages.zip",
    # Node.js dan NPM (sesuai kebutuhan Anda)
    "nodejs_18", 
    "npm-9_x",
    # Web Server (Nginx)
    "nginx",
    # libmysqlclient (hanya untuk memastikan, tapi pdo-mysql lebih penting)
    "libmysqlclient", 
    "git" # Pastikan git tersedia untuk composer
]

[phases.build]
# KOREKSI: Tambahkan perintah instalasi dependensi PHP (Composer)
# Jalankan Composer, lalu jalankan build frontend (npm run build)
cmds = [
    "composer install --no-dev --prefer-dist",
    "php artisan key:generate --force",
    "npm run build"
]

[start]
# TAMBAHAN: Anda perlu menentukan bagaimana Nginx dan PHP-FPM berjalan bersama.
# Ini adalah bagian yang paling kompleks. Biasanya Anda akan menggunakan
# skrip shell untuk menjalankan kedua proses (FPM dan Nginx) secara bersamaan.
# Contoh sederhana (mungkin tidak berjalan di Railway tanpa konfigurasi Nginx):
cmd = "php-fpm & nginx -g 'daemon off;'"
# ATAU jika Anda tidak menggunakan Nginx dan hanya menggunakan server Laravel untuk testing:
# cmd = "php artisan serve --host 0.0.0.0 --port $PORT"